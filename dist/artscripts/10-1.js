// Generated by CoffeeScript 1.12.6
(function() {
  var GenArt, argv, art, filename, options, path, run, seed;

  path = require('path');

  argv = require('yargs').alias('s', 'seed').argv;

  seed = Date.now();

  GenArt = require('./GenArt');

  filename = path.basename(__filename, '.js') + '-' + seed;

  options = {
    filename: filename,
    count: 25,
    numTicks: 100,
    bgColor: 'black',
    fillColor: 'white'
  };

  art = new GenArt(seed, options);

  art.makeParticles = function() {
    var offsetAmount;
    console.log('Making ' + this.count + ' particles');
    offsetAmount = this.chance.integer({
      min: 25,
      max: 750
    });
    this.data = d3.range(this.count).map((function(_this) {
      return function() {
        var c, offset, targetOffsetAmount, x, y;
        targetOffsetAmount = _this.chance.integer({
          min: _this.width / 2,
          max: _this.width
        });
        offset = {};
        offset.x = _this.chance.floating({
          min: -offsetAmount,
          max: offsetAmount
        });
        offset.y = _this.chance.floating({
          min: -offsetAmount,
          max: offsetAmount
        });
        x = (_this.width / 2) + offset.x;
        y = (_this.height / 2) + offset.y;
        c = d3.hsl('white');
        c.opacity = _this.opacity;
        return {
          x: x,
          y: y,
          targetX: x + _this.chance.floating({
            min: -targetOffsetAmount,
            max: targetOffsetAmount
          }),
          targetY: y + _this.chance.floating({
            min: -targetOffsetAmount,
            max: targetOffsetAmount
          }),
          color: c.toString()
        };
      };
    })(this));
    return this.data;
  };

  art.tick = function() {
    var angle, increase, ticks;
    if (!this.ticks) {
      ticks = 0;
    }
    this.ticks++;
    increase = Math.PI * 2 / this.numTicks;
    angle = 0;
    return this.data.forEach((function(_this) {
      return function(d, i) {
        var noiseValue;
        noiseValue = _this.simplex.noise2D(d.x, d.y);
        angle += increase;
        if (_this.chance.bool({
          likelihood: 50
        })) {
          if (d.x < d.targetX) {
            d.x += _this.chance.floating({
              min: 0,
              max: 2
            });
          } else if (d.x < d.targetX) {
            d.x += _this.chance.floating({
              min: -2,
              max: 0
            });
          }
        }
        if (_this.chance.bool({
          likelihood: 50
        })) {
          if (d.y < d.targetY) {
            d.y += _this.chance.floating({
              min: 0,
              max: 2
            });
          } else if (d.y < d.targetY) {
            d.y += _this.chance.floating({
              min: -2,
              max: 0
            });
          }
        }
        _this.ctx.beginPath();
        _this.ctx.rect(d.x, d.y, 1, 1);
        _this.ctx.fillStyle = _this.fillColor;
        _this.ctx.fill();
        return _this.ctx.closePath();
      };
    })(this));
  };

  run = function() {
    var genart;
    if (argv.seed) {
      seed = argv.seed;
    } else {
      seed = Date.now();
    }
    genart = new GenArt(seed, options);
    return genart.init({
      save: true
    });
  };

  if (require.main === module) {
    run();
  }

  module.exports = art;

}).call(this);
