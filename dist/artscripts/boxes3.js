// Generated by CoffeeScript 1.12.6
(function() {
  var argv, canvasModule, d3, d3Node, d3n, fs, makeArt, randGen, run;

  fs = require('fs');

  d3 = require('d3');

  d3Node = require('d3-node');

  canvasModule = require('canvas-prebuilt');

  randGen = require('random-seed');

  d3n = new d3Node({
    canvasModule: canvasModule
  });

  argv = require('yargs').alias('s', 'seed').argv;

  run = function() {
    var seed;
    if (argv.seed) {
      seed = argv.seed;
    } else {
      seed = Date.now();
    }
    return makeArt(seed);
  };

  makeArt = function(seed) {
    var canvas, count, ctx, data, fileOutput, height, i, j, rand, width;
    rand = new randGen();
    rand.seed(seed);
    console.log('seed', seed);
    canvas = d3n.createCanvas(850, 625);
    ctx = canvas.getContext('2d');
    width = canvas.width;
    height = canvas.height;
    i = 0;
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, width, height);
    count = rand(350);
    data = d3.range(count).map(function() {
      var c, color, x, y;
      i++;
      x = rand(width);
      y = rand(height);
      color = 'rgb(237, 11, 79)';
      c = d3.hsl(color);
      c.h += rand(120);
      return {
        x1: rand(width),
        y1: rand(height),
        x2: rand(92),
        y2: rand(92),
        width: 2,
        height: i,
        color: c.toString(),
        size: 4
      };
    });
    for (j = 0; j <= 100; j++) {
      data.forEach(function(d, i) {
        var c, color, size;
        if (rand(100) > 50) {
          d.x = d.x++;
        } else {
          d.x = d.x--;
        }
        if (d.y % 3) {
          d.y++;
        }
        size = rand(d.size + i);
        color = d.color;
        c = d3.hsl(color);
        c.h += rand(8);
        c.s -= rand(1);
        c.opacity = 0.25;
        d.color = c.toString();
        if (rand(100) > 20) {
          ctx.strokeStyle = d.color;
        } else {
          ctx.strokeStyle = '#FFF';
        }
        return ctx.strokeRect(d.x1 - size, d.y1 - size, size, size);
      });
    }
    fileOutput = './dist/' + seed + '.png';
    console.log('canvas output --> ' + fileOutput);
    canvas.pngStream().pipe(fs.createWriteStream(fileOutput));
    return canvas;
  };

  module.exports = makeArt;

  if (require.main === module) {
    run();
  }

}).call(this);
